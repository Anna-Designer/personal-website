<header class="modern-header" role="banner">
  {% comment %}
    Modern header with improved accessibility and performance
  {% endcomment %}

  <!-- Logo Section - Transparent Background -->
  <div class="logo-section">
    {% assign current_lang = page.lang | default: site.default_lang %}
    {% if current_lang == 'ru' %}
      {% assign home_url = '/ru/' %}
    {% else %}
      {% assign home_url = '/' %}
    {% endif %}
    {% assign is_home = page.url == '/' or page.url == '/ru/' %}

    <a href="{{ home_url }}"
       class="brand-logo"
       {% if is_home %}aria-current="page"{% endif %}
       aria-label="{{ site.locales[current_lang].nav.home | default: 'Home' }}">
      <img src="{{ '/assets/images/logo.svg' | relative_url }}"
           alt="{{ site.locales[current_lang].author }}"
           class="logo-image"
           width="40"
           height="40">
    </a>
  </div>

  <!-- Navigation Chip - Blur Background -->
  <div class="nav-chip-container">
    <nav role="navigation" class="nav-chip" aria-label="Main navigation">
      {% for item in site.navigation.primary %}
        {% unless item.key == 'contact' %}
          {% assign nav_url = item.url %}
          {% if item.key == 'services' %}
            {% assign nav_url = home_url | append: '#services' %}
          {% elsif current_lang == 'ru' and item.url != '#portfolio' and item.url != '#services' %}
            {% assign nav_url = '/ru' | append: item.url %}
          {% endif %}

          <a href="{{ nav_url }}"
             class="nav-chip-link"
             {% if page.url contains item.url %}aria-current="page"{% endif %}>
            {{ site.locales[current_lang].nav[item.key] | default: item.key }}
          </a>
        {% endunless %}
      {% endfor %}

      <!-- Language Switcher -->
      {% include language-switcher.html %}
    </nav>

    <!-- Mobile Menu Button -->
    <button class="mobile-menu-btn"
            aria-label="{{ site.locales[current_lang].nav.toggle_menu | default: 'Toggle navigation menu' }}"
            aria-expanded="false"
            aria-controls="mobile-nav"
            type="button">
      <span class="menu-icon" aria-hidden="true"></span>
      <span class="menu-icon" aria-hidden="true"></span>
      <span class="menu-icon" aria-hidden="true"></span>
    </button>
  </div>

  <!-- Mobile Navigation Overlay -->
  <div class="mobile-nav-overlay" id="mobile-nav" aria-hidden="true">
    <nav class="mobile-nav" aria-label="Mobile navigation">
      {% for item in site.data.navigation %}
        {% unless item.title == 'Contact' %}
          {% assign nav_url = item.url %}
          {% if item.title == 'Services' %}
            {% assign nav_url = home_url | append: '#services' %}
          {% elsif page.lang == 'ru' and item.url != '#portfolio' and item.url != '#services' %}
            {% assign nav_url = '/ru' | append: item.url %}
          {% endif %}

          <a href="{{ nav_url }}"
             class="mobile-nav-link"
             {% if page.url contains item.url %}aria-current="page"{% endif %}>
            {{ site.data.translations[page.lang].nav[item.title | downcase] | default: item.title }}
          </a>
        {% endunless %}
      {% endfor %}

      <!-- Mobile Language Options -->
      <div class="mobile-language-options" role="group" aria-label="Language options">
        {% assign current_page = page.url %}
        {% if page.lang == 'ru' %}
          {% assign english_url = current_page | replace: '/ru/', '/' | replace: '/ru', '/' %}
          {% if english_url == '//' %}{% assign english_url = '/' %}{% endif %}
          <a href="{{ english_url }}"
             class="mobile-nav-link{% if page.lang == 'en' %} active{% endif %}"
             lang="en"
             hreflang="en">🌐 English</a>
          <a href="{{ current_page }}"
             class="mobile-nav-link active"
             lang="ru"
             hreflang="ru"
             aria-current="page">🌐 Русский</a>
        {% else %}
          {% assign russian_url = current_page == '/' ? '/ru/' : '/ru' | append: current_page %}
          <a href="{{ current_page }}"
             class="mobile-nav-link active"
             lang="en"
             hreflang="en"
             aria-current="page">🌐 English</a>
          <a href="{{ russian_url }}"
             class="mobile-nav-link{% if page.lang == 'ru' %} active{% endif %}"
             lang="ru"
             hreflang="ru">🌐 Русский</a>
        {% endif %}
      </div>
    </nav>
  </div>
</header>
