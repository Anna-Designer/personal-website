---
layout: post
title: "Быстрые, добрые, полезные ревью кода"
date: 2025-01-10
lang: ru
categories: [development]
tags: [code-review, collaboration, development-process, team-culture]
excerpt: "Ревью кода определяют скорость команды и культуру. Система ревью, которая поставляет ценность без сжигания отношений."
image: /assets/images/bgs/starry_bg.png
---

Ревью кода определяют скорость команды и культуру. Система ревью, которая поставляет ценность без сжигания отношений.

## Философия ревью

**Хорошие ревью кода:**

- **Быстрые:** Часы, не дни
- **Добрые:** Предполагают положительные намерения, предлагают улучшения
- **Полезные:** Фокусируются на воздействии, а не на стилевых предпочтениях

**Плохие ревью:**

- Спорят о тривиальных выборах
- Блокируют на личных предпочтениях
- Не хватает контекста для обратной связи

## Пред-ревью: Настройка на успех

### Обязанности автора

```markdown
Шаблон PR:

## Что и почему

- Краткий контекст изменения
- Ссылка на тикет/задачу

## Тестирование

- Как проверить, что изменение работает
- Рассмотренные граничные случаи

## Заметки для ревьюера

- Области, где вы хотите конкретную обратную связь
- Известные компромиссы, которые вы сделали
```

### Размер имеет значение

- **Цель:** 200-400 строк
- **Максимум:** 800 строк (разделите, если больше)
- **Единая ответственность:** Одно логическое изменение на PR

## Процесс ревью

### 1) Первый проход: Архитектура и логика (15 мин)

**Вопросы для задания:**

- Решает ли это правильную проблему?
- Подход обоснован?
- Есть ли очевидные ошибки или граничные случаи?
- Подходит ли к существующим паттернам?

**Не отвлекайтесь на:**

- Форматирование (используйте автоматизированные инструменты)
- Именование (если только не действительно запутанное)
- Незначительные стилевые различия

### 2) Второй проход: Детали реализации (10 мин)

**Фокус на:**

- Обработка ошибок
- Влияние на производительность
- Проблемы безопасности
- Покрытие тестами для критических путей

### 3) Фреймворк обратной связи

**Используйте модель SBI:**

- **Ситуация:** "В пользовательском сервисе..."
- **Поведение:** "...эта функция не обрабатывает null пользователей..."
- **Воздействие:** "...что может вызвать 500 ошибки в продакшене."

**Маркируйте вашу обратную связь:**

- `nit:` Незначительный стиль/предпочтение (автор может игнорировать)
- `suggestion:` Хорошо-иметь улучшение
- `question:` Ищу разъяснения
- `concern:` Должно быть адресовано перед мержем

## Примеры комментариев ревью

### ❌ Бесполезные

```
"Это неправильно."
"Используйте лучшее имя переменной."
"Я бы сделал это по-другому."
```

### ✅ Полезные

```
nit: Рассмотрите `isEmailValid` вместо `flag` для ясности

suggestion: Можем ли мы вынести эту логику валидации в helper функцию?
Она используется в 3 местах и будет легче тестировать в изоляции.

concern: Этот запрос выполняется при каждой загрузке страницы.
Должны ли мы добавить кеширование или перенести в фоновую задачу?

question: Что происходит, если API возвращает 500 здесь?
Должны ли мы откатываться к кешированным данным?
```

## Работа с разногласиями

### Когда вы автор

- **Просите контекст:** "Помогите понять проблему с подходом X"
- **Предлагайте альтернативы:** "Что если мы сделаем Y вместо этого?"
- **Ограничивайте дискуссии по времени:** "Давайте попарируем над этим 15 минут"

### Когда вы ревьюер

- **Предлагайте, не требуйте:** "Рассматривали ли вы..." против "Вы должны..."
- **Объясняйте почему:** Ссылайтесь на принципы, прошлые инциденты или влияние на бизнес
- **Предлагайте паринг:** Сложная обратная связь работает лучше лицом к лицу

## Целевые скорости ревью

| Размер PR     | Время ревью | Ответ автора |
| ------------- | ----------- | ------------ |
| < 50 строк    | 2 часа      | 1 час        |
| 50-200 строк  | 4 часа      | 2 часа       |
| 200-400 строк | 1 день      | 4 часа       |
| 400+ строк    | Разделите   | Разделите    |

## Автоматизация, которая помогает

### Pre-commit хуки

```bash
# Форматирование, линтинг и запуск тестов
pre-commit install
```

### Назначение ревьюеров

- Назначение по кругу
- Требования владельцев кода для критических областей
- Опциональные ревьюеры для возможностей обучения

### Требования мержа

- 1-2 одобрения (зависит от команды)
- Все разговоры разрешены
- CI проходит
- Актуален с основной веткой

## Анти-паттерны ревью

### Перфекционист

- Блокирует на незначительных стилевых предпочтениях
- Просит обширный рефакторинг в каждом PR
- **Исправление:** Разделяйте "хорошо иметь" от "должно быть"

### Призрак

- Одобряет без чтения
- Никогда не оставляет обратную связь
- **Исправление:** Ротируйте назначения ревьюеров, изредка парьтесь

### Историк

- Поднимает каждое прошлое решение
- Хочет понять всю эволюцию кодовой базы
- **Исправление:** Фокусируйтесь на текущем изменении, а не на путешествии

## Построение культуры ревью

### Для менеджеров

- **Измеряйте время ревью,** а не только вывод кода
- **Отмечайте хорошую обратную связь** в ретро
- **Моделируйте хорошие ревью** когда участвуете

### Для команд

- **Ревьюйте ваши ревью:** Какая обратная связь была наиболее полезной?
- **Ротируйте ревьюеров:** Кросс-опыляйте знания
- **Асинхронно в первую очередь:** Не ждите встреч для разрешения простой обратной связи

## Правило 24 часов

Если PR остается без ревью 24 часа:

1. Автор тегирует конкретных ревьюеров
2. Автор упоминает в командном чате
3. Менеджер назначает экстренного ревьюера

Ревью кода — командный спорт. Быстрые, добрые и полезные ревью создают доверие, распространяют знания и поставляют лучшее программное обеспечение.
